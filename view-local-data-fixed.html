<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Local Data - MRD Website</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            border: 1px solid #FFD700;
        }
        .header h1 {
            color: #FFD700;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .data-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #FFD700;
        }
        .section-title {
            color: #FFD700;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
        }
        .data-table th {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }
        .data-table td {
            padding: 12px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        .data-table tr:hover {
            background: rgba(255, 215, 0, 0.05);
        }
        .data-table tr:last-child td {
            border-bottom: none;
        }
        button {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 8px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .btn-danger {
            background: linear-gradient(45deg, #ff4757, #ff3838);
            color: #fff;
        }
        .status {
            margin: 15px 0;
            padding: 12px;
            border-radius: 6px;
            font-weight: 600;
        }
        .success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #22c55e;
        }
        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }
        .info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #3b82f6;
        }
        .warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #f59e0b;
            color: #f59e0b;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #ccc;
        }
        .empty-state h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #ccc;
            font-size: 0.9rem;
        }
        pre {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä MRD Local Data Viewer</h1>
        <p>View and manage all data stored locally by the MRD Brain System</p>
    </div>

    <!-- Statistics Overview -->
    <div class="data-section">
        <h2 class="section-title">üìà Data Overview</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-submissions">0</div>
                <div class="stat-label">Form Submissions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-analytics">0</div>
                <div class="stat-label">Analytics Events</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="storage-size">0KB</div>
                <div class="stat-label">Storage Used</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="last-activity">Never</div>
                <div class="stat-label">Last Activity</div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="data-section">
        <h2 class="section-title">üöÄ Quick Actions</h2>
        <button onclick="refreshAllData()">üîÑ Refresh All Data</button>
        <button onclick="testFormSubmission()">üìù Submit Test Form</button>
        <button onclick="exportData()" class="btn-secondary">üíæ Export Data</button>
        <button onclick="clearAllData()" class="btn-danger">üóëÔ∏è Clear All Data</button>
        <div id="action-status" class="status info">Ready to view data</div>
    </div>

    <!-- Form Submissions -->
    <div class="data-section">
        <h2 class="section-title">üìã Form Submissions</h2>
        <button onclick="viewFormSubmissions()">View Form Data</button>
        <button onclick="refreshFormData()" class="btn-secondary">Refresh</button>
        <div id="form-submissions-container">
            <div class="empty-state">
                <h3>No form submissions yet</h3>
                <p>Click "View Form Data" to load submissions or submit a test form</p>
            </div>
        </div>
    </div>

    <!-- Analytics Data -->
    <div class="data-section">
        <h2 class="section-title">üìä Analytics Data</h2>
        <button onclick="viewAnalytics()">View Analytics</button>
        <button onclick="refreshAnalytics()" class="btn-secondary">Refresh</button>
        <div id="analytics-container">
            <div class="empty-state">
                <h3>No analytics data yet</h3>
                <p>Click "View Analytics" to load data or interact with the website</p>
            </div>
        </div>
    </div>

    <!-- Raw LocalStorage Data -->
    <div class="data-section">
        <h2 class="section-title">üîç Raw LocalStorage Data</h2>
        <button onclick="viewAllLocalStorage()">View All Data</button>
        <button onclick="checkLocalStorage()" class="btn-secondary">Check Storage</button>
        <div id="raw-data-container">
            <div class="empty-state">
                <h3>No raw data displayed</h3>
                <p>Click "View All Data" to see raw localStorage contents</p>
            </div>
        </div>
    </div>

    <!-- MRD Brain System -->
    <script src="mrd-brain-system.js"></script>
    
    <script>
        // Global variables
        let formSubmissions = [];
        let analyticsData = {};

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing MRD Data Viewer...');
            
            // Initialize MRD Brain System
            if (typeof MRDBrainSystem !== 'undefined') {
                window.MRDBrain = new MRDBrainSystem();
                console.log('‚úÖ MRD Brain System initialized');
            } else {
                console.error('‚ùå MRD Brain System not loaded');
                showStatus('‚ùå MRD Brain System not available', 'error');
            }
            
            // Load initial data
            loadAllData();
        });

        // Load all data
        function loadAllData() {
            console.log('üìä Loading all data...');
            loadFormSubmissions();
            loadAnalyticsData();
            updateStatistics();
        }

        // Load form submissions
        function loadFormSubmissions() {
            try {
                const data = localStorage.getItem('mrd_brain_form_submissions');
                formSubmissions = data ? JSON.parse(data) : [];
                console.log(`üìã Loaded ${formSubmissions.length} form submissions`);
            } catch (error) {
                console.error('Error loading form submissions:', error);
                formSubmissions = [];
            }
        }

        // Load analytics data
        function loadAnalyticsData() {
            try {
                const data = localStorage.getItem('mrd_brain_analytics');
                analyticsData = data ? JSON.parse(data) : {};
                console.log(`üìä Loaded analytics data for ${Object.keys(analyticsData).length} sessions`);
            } catch (error) {
                console.error('Error loading analytics data:', error);
                analyticsData = {};
            }
        }

        // Update statistics
        function updateStatistics() {
            document.getElementById('total-submissions').textContent = formSubmissions.length;
            
            const totalEvents = Object.keys(analyticsData).reduce((total, sessionId) => {
                const session = analyticsData[sessionId];
                return total + (session.events ? session.events.length : 0);
            }, 0);
            document.getElementById('total-analytics').textContent = totalEvents;
            
            // Calculate storage size
            let totalSize = 0;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('mrd_brain_')) {
                    totalSize += localStorage.getItem(key).length;
                }
            }
            document.getElementById('storage-size').textContent = Math.round(totalSize / 1024) + 'KB';
            
            // Last activity
            if (formSubmissions.length > 0) {
                const lastSubmission = formSubmissions[formSubmissions.length - 1];
                document.getElementById('last-activity').textContent = formatTimestamp(lastSubmission.timestamp);
            }
        }

        // View form submissions
        function viewFormSubmissions() {
            const container = document.getElementById('form-submissions-container');
            
            if (formSubmissions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No form submissions found</h3>
                        <p>Submit a form to see data here</p>
                    </div>
                `;
                return;
            }

            const table = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Page Source</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Course Interest</th>
                            <th>Message</th>
                            <th>Form ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${formSubmissions.map(submission => `
                            <tr>
                                <td>${formatTimestamp(submission.timestamp)}</td>
                                <td>${submission.page_source || 'Unknown'}</td>
                                <td>${submission.name || 'N/A'}</td>
                                <td>${submission.email || 'N/A'}</td>
                                <td>${submission.phone || 'N/A'}</td>
                                <td>${submission.course_interest || submission.service_interest || 'N/A'}</td>
                                <td>${truncateText(submission.message || 'N/A', 50)}</td>
                                <td>${submission.form_id || 'N/A'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
            showStatus(`‚úÖ Displayed ${formSubmissions.length} form submissions`, 'success');
        }

        // View analytics data
        function viewAnalytics() {
            const container = document.getElementById('analytics-container');
            
            if (Object.keys(analyticsData).length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No analytics data found</h3>
                        <p>User interactions will appear here</p>
                    </div>
                `;
                return;
            }

            const events = [];
            Object.keys(analyticsData).forEach(sessionId => {
                const session = analyticsData[sessionId];
                if (session.events) {
                    session.events.forEach(event => {
                        events.push({
                            timestamp: event.timestamp,
                            event_type: event.type,
                            session_id: sessionId,
                            page: event.page || 'Unknown',
                            data: event.data || {}
                        });
                    });
                }
            });

            if (events.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No analytics events found</h3>
                        <p>User interactions will appear here</p>
                    </div>
                `;
                return;
            }

            const table = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Event Type</th>
                            <th>Session ID</th>
                            <th>Page</th>
                            <th>Event Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${events.map(event => `
                            <tr>
                                <td>${formatTimestamp(event.timestamp)}</td>
                                <td><span class="status info">${event.event_type}</span></td>
                                <td>${event.session_id}</td>
                                <td>${event.page}</td>
                                <td>${truncateText(JSON.stringify(event.data), 30)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
            showStatus(`‚úÖ Displayed ${events.length} analytics events`, 'success');
        }

        // View all localStorage data
        function viewAllLocalStorage() {
            const container = document.getElementById('raw-data-container');
            
            try {
                const allData = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('mrd_brain_')) {
                        try {
                            allData[key] = JSON.parse(localStorage.getItem(key));
                        } catch (e) {
                            allData[key] = localStorage.getItem(key);
                        }
                    }
                }
                
                if (Object.keys(allData).length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No MRD Brain data found in localStorage</h3>
                            <p>Submit a form or interact with the website to see data here</p>
                        </div>
                    `;
                    showStatus('‚ÑπÔ∏è No MRD Brain data found in localStorage', 'warning');
                } else {
                    container.innerHTML = `<pre>${JSON.stringify(allData, null, 2)}</pre>`;
                    showStatus(`‚úÖ Found ${Object.keys(allData).length} MRD Brain data entries`, 'success');
                }
            } catch (error) {
                container.innerHTML = `<div class="status error">Error reading localStorage: ${error.message}</div>`;
                showStatus('‚ùå Error reading localStorage', 'error');
            }
        }

        // Check localStorage
        function checkLocalStorage() {
            const container = document.getElementById('raw-data-container');
            
            let totalKeys = 0;
            let mrdKeys = 0;
            let totalSize = 0;
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                totalKeys++;
                totalSize += localStorage.getItem(key).length;
                if (key.startsWith('mrd_brain_')) {
                    mrdKeys++;
                }
            }
            
            const info = `
                <div class="status info">
                    <h4>LocalStorage Information:</h4>
                    <p><strong>Total Keys:</strong> ${totalKeys}</p>
                    <p><strong>MRD Brain Keys:</strong> ${mrdKeys}</p>
                    <p><strong>Total Size:</strong> ${Math.round(totalSize / 1024)}KB</p>
                    <p><strong>Available Space:</strong> ~${Math.round((5 * 1024 * 1024 - totalSize) / 1024)}KB remaining</p>
                </div>
            `;
            
            container.innerHTML = info;
            showStatus('‚ÑπÔ∏è LocalStorage information displayed', 'info');
        }

        // Test form submission
        async function testFormSubmission() {
            const status = document.getElementById('action-status');
            
            if (window.MRDBrain && typeof window.MRDBrain.saveFormSubmission === 'function') {
                try {
                    status.innerHTML = 'üîÑ Submitting test form...';
                    status.className = 'status info';
                    
                    await window.MRDBrain.saveFormSubmission({
                        email: "test@example.com",
                        name: "Test User",
                        phone: "123-456-7890",
                        message: "Test submission from data viewer",
                        form_id: "test_form",
                        page_source: "data_viewer"
                    });
                    
                    status.innerHTML = '‚úÖ Test form submitted successfully!';
                    status.className = 'status success';
                    
                    // Refresh data
                    loadAllData();
                    
                } catch (error) {
                    status.innerHTML = '‚ùå Test form submission failed: ' + error.message;
                    status.className = 'status error';
                }
            } else {
                status.innerHTML = '‚ùå MRD Brain system not available';
                status.className = 'status error';
            }
        }

        // Export data
        function exportData() {
            const data = {
                formSubmissions: formSubmissions,
                analyticsData: analyticsData,
                exportDate: new Date().toISOString(),
                totalSubmissions: formSubmissions.length,
                totalAnalyticsEvents: Object.keys(analyticsData).reduce((total, sessionId) => {
                    const session = analyticsData[sessionId];
                    return total + (session.events ? session.events.length : 0);
                }, 0)
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mrd-data-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('‚úÖ Data exported successfully!', 'success');
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all MRD Brain data? This action cannot be undone.')) {
                try {
                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('mrd_brain_')) {
                            keysToRemove.push(key);
                        }
                    }
                    
                    keysToRemove.forEach(key => localStorage.removeItem(key));
                    
                    showStatus(`‚úÖ Cleared ${keysToRemove.length} data entries`, 'success');
                    loadAllData();
                    
                    // Clear containers
                    document.getElementById('form-submissions-container').innerHTML = `
                        <div class="empty-state">
                            <h3>No form submissions yet</h3>
                            <p>Submit a form to see data here</p>
                        </div>
                    `;
                    document.getElementById('analytics-container').innerHTML = `
                        <div class="empty-state">
                            <h3>No analytics data yet</h3>
                            <p>User interactions will appear here</p>
                        </div>
                    `;
                    document.getElementById('raw-data-container').innerHTML = `
                        <div class="empty-state">
                            <h3>No raw data displayed</h3>
                            <p>Click "View All Data" to see raw localStorage contents</p>
                        </div>
                    `;
                    
                } catch (error) {
                    showStatus('‚ùå Error clearing data: ' + error.message, 'error');
                }
            }
        }

        // Refresh functions
        function refreshAllData() {
            loadAllData();
            showStatus('üîÑ All data refreshed!', 'info');
        }

        function refreshFormData() {
            loadFormSubmissions();
            updateStatistics();
            showStatus('üîÑ Form data refreshed!', 'info');
        }

        function refreshAnalytics() {
            loadAnalyticsData();
            updateStatistics();
            showStatus('üîÑ Analytics data refreshed!', 'info');
        }

        // Utility functions
        function formatTimestamp(timestamp) {
            if (!timestamp) return 'N/A';
            try {
                return new Date(timestamp).toLocaleString();
            } catch (e) {
                return timestamp;
            }
        }

        function truncateText(text, maxLength) {
            if (!text) return 'N/A';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        function showStatus(message, type = 'info') {
            const status = document.getElementById('action-status');
            status.innerHTML = message;
            status.className = `status ${type}`;
        }
    </script>
</body>
</html>
